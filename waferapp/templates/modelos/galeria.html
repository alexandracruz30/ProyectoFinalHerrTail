{% extends "base/base.html" %}
{% load static %}
{% block title %}Galer칤a{% endblock %}

{% block content %}
<main class="min-h-screen bg-transparent py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 space-y-8">
        <div class="card header bg-transparent text-white p-8 rounded-2xl mb-8 text-center">
            <h1 class="text-4xl font-bold mb-2 text-black dark:text-white">游뱄 Galer칤a de CNN EXPLORER</h1>
        </div>
        <!-- Carrusel de Datos -->
        <div class="carrusel-container relative w-full max-w-[1400px] mx-auto bg-transparent rounded-2xl p-8 overflow-hidden mb-8">
            <div class="carrusel-titulo text-2xl mb-8 text-[#0b3557] dark:text-blue-200 font-bold text-center relative after:content-[''] after:absolute after:bottom-[-10px] after:left-1/2 after:-translate-x-1/2 after:w-[60px] after:h-1 after:bg-gradient-to-r after:from-[#0078d7] after:to-[#005fa3] after:rounded"></div>
            <button class="carrusel-btn left absolute top-1/2 -translate-y-1/2 left-8 bg-gradient-to-r from-[#0078d7] to-[#005fa3] text-white rounded-full w-14 h-14 text-2xl cursor-pointer z-10 opacity-80 hover:opacity-100 hover:scale-110 shadow-lg border-none" onclick="moverCarrusel('datos', -1)">&#10094;</button>
            
            <div class="carrusel-main flex flex-col items-center gap-8">
                <div class="carrusel-imagenes-wrapper w-full relative h-[500px] overflow-hidden rounded-xl flex justify-center items-center">
                    <div class="carrusel-imagenes relative w-full h-full flex items-center justify-center" id="carrusel-datos">
                        {% for img in datos_imgs %}
                            <img src="{% static img.src %}" alt="{{ img.alt }}"
                            data-title="{{ img.title }}"
                            data-desc="{{ img.desc }}"
                            class="absolute w-[700px] h-[450px] object-contain rounded-xl transition-all duration-500 ease-in-out cursor-pointer bg-gray-50 dark:bg-gray-900 shadow-xl" />
                        {% endfor %}
                    </div>
                </div>
                <div class="carrusel-info w-full max-w-[800px] p-6 bg-white/90 dark:bg-gray-900/90 rounded-xl backdrop-blur-md text-center shadow-md" id="info-datos">
                    <h3 class="text-[#0b3557] dark:text-blue-200 text-2xl mb-4 font-semibold">An치lisis de Distribuci칩n</h3>
                    <p class="text-gray-600 dark:text-gray-300 leading-relaxed mb-5 text-base">Gr치fico que muestra la distribuci칩n de datos en el conjunto de entrenamiento, revelando patrones importantes en la clasificaci칩n.</p>
                    <div class="carrusel-counter bg-gradient-to-r from-[#0078d7] to-[#005fa3] text-white px-5 py-2 rounded-full text-base font-semibold inline-block">1 / {{ datos_imgs|length }}</div>
                </div>  
            </div>
            <div class="carrusel-indicators flex justify-center gap-2 mt-5" id="indicators-datos">
                {% for i in datos_imgs %}
                    <div class="indicator w-4 h-4 rounded-full bg-gray-700/30 dark:bg-gray-600/50 cursor-pointer transition-all duration-300 ease-in-out" onclick="irAImagen('datos', {{ forloop.counter0 }})"></div>
                {% endfor %}
            </div>
            <button class="carrusel-btn right absolute top-1/2 -translate-y-1/2 right-8 bg-gradient-to-r from-[#0078d7] to-[#005fa3] text-white rounded-full w-14 h-14 text-2xl cursor-pointer z-10 opacity-80 hover:opacity-100 hover:scale-110 shadow-lg border-none" onclick="moverCarrusel('datos', 1)">&#10095;</button>
        </div>

        <!-- Carrusel de Obleas -->
        <div class="carrusel-container relative w-full max-w-[1400px] mx-auto bg-transparent rounded-2xl p-8 overflow-hidden mb-8">
            <div class="carrusel-titulo text-2xl mb-8 text-[#0b3557] dark:text-blue-200 font-bold text-center relative after:content-[''] after:absolute after:bottom-[-10px] after:left-1/2 after:-translate-x-1/2 after:w-[60px] after:h-1 after:bg-gradient-to-r after:from-[#0078d7] after:to-[#005fa3] after:rounded"></div>
            <button class="carrusel-btn left absolute top-1/2 -translate-y-1/2 left-8 bg-gradient-to-r from-[#0078d7] to-[#005fa3] text-white rounded-full w-14 h-14 text-2xl cursor-pointer z-10 opacity-80 hover:opacity-100 hover:scale-110 shadow-lg border-none" onclick="moverCarrusel('obleas', -1)">&#10094;</button>
            
            <div class="carrusel-main flex flex-col items-center gap-8">
                <div class="carrusel-imagenes-wrapper w-full relative h-[500px] overflow-hidden rounded-xl flex justify-center items-center">
                    <div class="carrusel-imagenes relative w-full h-full flex items-center justify-center" id="carrusel-obleas">
                        {% for img in obleas_imgs %}
                            <img src="{% static img.src %}" alt="{{ img.alt }}"
                            data-title="{{ img.title }}"
                            data-desc="{{ img.desc }}"
                            class="absolute w-[700px] h-[450px] object-contain rounded-xl transition-all duration-500 ease-in-out cursor-pointer bg-gray-50 dark:bg-gray-900 shadow-xl" />
                        {% endfor %}
                    </div>
                </div>
                <div class="carrusel-info w-full max-w-[800px] p-6 bg-white/90 dark:bg-gray-900/90 rounded-xl backdrop-blur-md text-center shadow-md" id="info-obleas">
                    <h3 class="text-[#0b3557] dark:text-blue-200 text-2xl mb-4 font-semibold">Oblea Tipo A</h3>
                    <p class="text-gray-600 dark:text-gray-300 leading-relaxed mb-5 text-base">An치lisis de defectos en obleas semiconductoras tipo A, mostrando patrones de falla caracter칤sticos.</p>
                    <div class="carrusel-counter bg-gradient-to-r from-[#0078d7] to-[#005fa3] text-white px-5 py-2 rounded-full text-base font-semibold inline-block">1 / {{ obleas_imgs|length }}</div>
                </div>
            </div>
            <div class="carrusel-indicators flex justify-center gap-2 mt-5" id="indicators-obleas">
                {% for i in obleas_imgs %}
                    <div class="indicator w-4 h-4 rounded-full bg-gray-700/30 dark:bg-gray-600/50 cursor-pointer transition-all duration-300 ease-in-out" onclick="irAImagen('obleas', {{ forloop.counter0 }})"></div>
                {% endfor %}
            </div>
            <button class="carrusel-btn right absolute top-1/2 -translate-y-1/2 right-8 bg-gradient-to-r from-[#0078d7] to-[#005fa3] text-white rounded-full w-14 h-14 text-2xl cursor-pointer z-10 opacity-80 hover:opacity-100 hover:scale-110 shadow-lg border-none" onclick="moverCarrusel('obleas', 1)">&#10095;</button>
        </div>
    </div>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="{% static 'js/dash.js' %}"></script>
<script>
let indices = {
    datos: 0,
    obleas: 0
};

function mostrarImagenCarrusel(nombre) {
    const imagenes = document.querySelectorAll(`#carrusel-${nombre} img`);
    const info = document.getElementById(`info-${nombre}`);
    const indicators = document.querySelectorAll(`#indicators-${nombre} .indicator`);
    
    imagenes.forEach((img, i) => {
        img.classList.remove('active', 'prev', 'next', 'hidden');
        img.style.opacity = '';
        img.style.transform = '';
        img.style.zIndex = '';
        if (i === indices[nombre]) {
            img.classList.add('active');
            img.style.opacity = '1';
            img.style.transform = 'translateX(0) scale(1)';
            img.style.zIndex = '3';
            info.querySelector('h3').textContent = img.dataset.title;
            info.querySelector('p').textContent = img.dataset.desc;
            info.querySelector('.carrusel-counter').textContent = `${i + 1} / ${imagenes.length}`;
        } else if (i === indices[nombre] - 1 || (indices[nombre] === 0 && i === imagenes.length - 1)) {
            img.classList.add('prev');
            img.style.opacity = '0.6';
            img.style.transform = 'translateX(-200px) scale(0.75)';
            img.style.zIndex = '2';
        } else if (i === indices[nombre] + 1 || (indices[nombre] === imagenes.length - 1 && i === 0)) {
            img.classList.add('next');
            img.style.opacity = '0.6';
            img.style.transform = 'translateX(200px) scale(0.75)';
            img.style.zIndex = '2';
        } else {
            img.classList.add('hidden');
            img.style.opacity = '0';
            img.style.transform = 'translateX(0) scale(0.5)';
            img.style.zIndex = '1';
        }
    });

    indicators.forEach((indicator, i) => {
        indicator.classList.toggle('bg-gradient-to-r', i === indices[nombre]);
        indicator.classList.toggle('from-[#0078d7]', i === indices[nombre]);
        indicator.classList.toggle('to-[#005fa3]', i === indices[nombre]);
        indicator.classList.toggle('scale-125', i === indices[nombre]);
        indicator.classList.toggle('bg-gray-700/30', i !== indices[nombre]);
        indicator.classList.toggle('dark:bg-gray-600/50', i !== indices[nombre]);
    });
}

function moverCarrusel(nombre, direccion) {
    const imagenes = document.querySelectorAll(`#carrusel-${nombre} img`);
    indices[nombre] += direccion;
    if (indices[nombre] < 0) {
        indices[nombre] = imagenes.length - 1;
    }
    if (indices[nombre] >= imagenes.length) {
        indices[nombre] = 0;
    }
    mostrarImagenCarrusel(nombre);
}

function irAImagen(nombre, indice) {
    indices[nombre] = indice;
    mostrarImagenCarrusel(nombre);
}

document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') {
        moverCarrusel('datos', -1);
    } else if (e.key === 'ArrowRight') {
        moverCarrusel('datos', 1);
    }
});

document.addEventListener('DOMContentLoaded', () => {
    mostrarImagenCarrusel('datos');
    mostrarImagenCarrusel('obleas');
});

let startX = 0;
let endX = 0;

document.addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX;
});

document.addEventListener('touchend', (e) => {
    endX = e.changedTouches[0].clientX;
    handleSwipe();
});

function handleSwipe() {
    const threshold = 50;
    const diff = startX - endX;
    if (Math.abs(diff) > threshold) {
        if (diff > 0) {
            moverCarrusel('datos', 1);
        } else {
            moverCarrusel('datos', -1);
        }
    }
}
</script>
{% endblock %}